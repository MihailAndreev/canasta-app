# Валидация на чисти meld-ове (сетове) в Българска канаста

## Обхват
Този документ описва **пълните правила за валидиране на чисти meld-ове от сетове**, включително:
- чисти сетове без wild карти;
- чисти канасти;
- **специалния случай: сет / канаста, изградени само от жокери**.

Документът е предназначен за:
- игрова логика;
- backend / frontend валидиране;
- тестове;
- документация.

---

## 1. Термини и дефиниции

### 1.1 Сет (Set)
Комбинация от **карти с еднакъв ранг** (число/фигура).

Примери за ранг:
- 4, 5, 6, …, 10
- J, Q, K, A

### 1.2 Чист meld
Meld **без участие на wild карти** (2 или жокер), **с изключение на специалния случай „wild-only“**, описан отделно.

### 1.3 Канаста
Meld от **точно 7 карти**.

---

## 2. Основни правила за чист сет

### 2.1 Минимален размер
- Минимум **3 карти**.
- Няма горна граница (освен логическите и игровите ограничения).

### 2.2 Ранг
- Всички карти **трябва да са от един и същи ранг**.
- Боите **нямат значение**.

### 2.3 Забрана за смесване
- В един сет **не могат** да участват различни рангове.
- Смесване на рангове прави meld-а **невалиден**.

---

## 3. Валидиране на чист сет (без jokers / 2)

### 3.1 Формално условие
Сетът е валиден, ако и само ако:

```
брой карти ≥ 3
И
∀ карта ∈ meld: карта.rank == meld[0].rank
```

### 3.2 Валидни примери (чисти сетове)

- 7♣ 7♦ 7♥  
- K♠ K♦ K♣ K♥  
- A♣ A♦ A♥ A♠  

### 3.3 Невалидни примери

- 7♣ 7♦ 8♥ ❌ (смесени рангове)
- Q♠ Q♦ 2♣ ❌ (участва wild)
- J♠ J♦ ❌ (по-малко от 3 карти)

---

## 4. Чиста канаста от сет

### 4.1 Определение
Чиста канаста е:
- сет от **точно 7 карти**;
- **без wild карти**.

### 4.2 Формално условие

```
брой карти == 7
И
няма wild карти
И
всички карти са с еднакъв ранг
```

### 4.3 Валидни примери

- 9♣ 9♦ 9♥ 9♠ 9♣ 9♦ 9♥  
- Q♠ Q♦ Q♣ Q♥ Q♠ Q♦ Q♣  

### 4.4 Невалидни примери

- 7 карти, но с 1 joker ❌
- 7 карти, но различен ранг ❌

---

## 5. Специален случай: meld / канаста само от jokers

### 5.1 Статус
➡ **Разрешено** според официалните правила на Българска канаста.

Този тип meld се счита за **чист от гледна точка на структурата**, но е логически отделна категория.

---

## 6. Валидиране на joker-only сет

### 6.1 Минимален размер
- Минимум **3 жокера**.

### 6.2 Съдържание
- Всички карти са:
  - жокер, или
  - двойка (2), или
  - комбинация от двете.

### 6.3 Формално условие

```
брой карти ≥ 3
И
∀ карта ∈ meld: карта ∈ {JOKER, TWO}
```

### 6.4 Валидни примери

- J J J  
- 2 2 2  
- J 2 J  
- J J 2 2 2  

### 6.5 Невалидни примери

- J J A ❌
- 2 2 K ❌
- J 2 ❌ (по-малко от 3 карти)

---

## 7. Joker-only канаста

### 7.1 Определение
Канаста от **7 карти**, всички от които са:
- жокери и/или двойки.

### 7.2 Валидиране

```
брой карти == 7
И
∀ карта ∈ meld: карта ∈ {JOKER, TWO}
```

### 7.3 Точкови правила (за информация)

- Повече жокери от двойки → **1500 т.**
- Повече двойки от жокери → **1000 т.**

(Това **не влияе** на валидността, само на резултата.)

---

## 8. Обобщена таблица

| Тип meld | Минимум | Wild позволени | Валиден |
|--------|--------|---------------|--------|
| Чист сет | 3 | ❌ | ✅ |
| Чиста канаста | 7 | ❌ | ✅ |
| Joker-only сет | 3 | само wild | ✅ |
| Joker-only канаста | 7 | само wild | ✅ |

---

## 9. Чести грешки при имплементация

- ❌ третиране на joker-only сет като „мръсен“
- ❌ изискване за естествени карти при joker-only
- ❌ позволяване на joker в иначе чист сет
- ❌ валидиране на сет с < 3 карти

---

## 10. Препоръка за код логика

1. Ако meld съдържа **само jokers/2** → joker-only път.
2. Ако meld съдържа **0 wild** → чист сет.
3. Ако meld съдържа **смес** → НЕ Е чист сет (отива към mixed rules).

---

## Край на документа
